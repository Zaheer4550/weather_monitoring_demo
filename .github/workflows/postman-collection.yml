name: Postman Collection Sync + Hourly Monitor Summary

on:
  push:
    branches:
      - main
  schedule:
    # Run summary every hour
    - cron: "0 * * * *"
  workflow_dispatch:

jobs:
  # ---------------------------
  # 1. Sync collections on push
  # ---------------------------
  update-collections:
    if: github.event_name == 'push'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Update Current Weather Collection & Trigger Monitor
        env:
          POSTMAN_API_KEY: ${{ secrets.POSTMAN_API_KEY }}
        run: |
          mkdir -p artifacts/current-weather
          curl -s -X PUT "https://api.getpostman.com/collections/12345-current-weather-uid" \
            -H "X-Api-Key: $POSTMAN_API_KEY" \
            -H "Content-Type: application/json" \
            -d @Get\ Current\ Weather_A.postman_collection.json \
            -o artifacts/current-weather/collection_update.json

          curl -s -X POST "https://api.getpostman.com/monitors/45974783-1f084d67-0b9f-4bf0-8be3-5f0db8c25a4f/run" \
            -H "X-Api-Key: $POSTMAN_API_KEY" \
            -o artifacts/current-weather/monitor_trigger.json

      - name: Update Daily Forecast Collection & Trigger Monitor
        env:
          POSTMAN_API_KEY: ${{ secrets.POSTMAN_API_KEY }}
        run: |
          mkdir -p artifacts/daily-forecast
          curl -s -X PUT "https://api.getpostman.com/collections/12345-daily-forecast-uid" \
            -H "X-Api-Key: $POSTMAN_API_KEY" \
            -H "Content-Type: application/json" \
            -d @Get\ Daily\ Forecast-\ B.postman_collection.json \
            -o artifacts/daily-forecast/collection_update.json

          curl -s -X POST "https://api.getpostman.com/monitors/45974783-1f084d6c-cd8b-4f70-a56c-2c989dd363c6/run" \
            -H "X-Api-Key: $POSTMAN_API_KEY" \
            -o artifacts/daily-forecast/monitor_trigger.json

      - name: Update Historical Data Collection & Trigger Monitor
        env:
          POSTMAN_API_KEY: ${{ secrets.POSTMAN_API_KEY }}
        run: |
          mkdir -p artifacts/historical-data
          curl -s -X PUT "https://api.getpostman.com/collections/12345-historical-data-uid" \
            -H "X-Api-Key: $POSTMAN_API_KEY" \
            -H "Content-Type: application/json" \
            -d @Get\ Historical\ Data-\ C.postman_collection.json \
            -o artifacts/historical-data/collection_update.json

          curl -s -X POST "https://api.getpostman.com/monitors/45974783-1f084d7b-f131-47e0-b084-7926fd355a25/run" \
            -H "X-Api-Key: $POSTMAN_API_KEY" \
            -o artifacts/historical-data/monitor_trigger.json

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: monitor-updates
          path: artifacts/
